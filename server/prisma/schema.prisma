generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-arm64-openssl-3.0.x", "linux-musl-arm64-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator json {
  provider = "prisma-json-types-generator"
}

model User {
  id       Int    @id @default(autoincrement())
  name     String @default("anonymous")
  email    String @unique
  password String

  createdBy String?   @map("created_by")
  createdAt DateTime  @default(now()) @map("created_at")
  updatedBy String?   @map("updated_by")
  updatedAt DateTime  @updatedAt @map("updated_at")
  isDeleted Boolean   @default(false) @map("is_deleted")
  deletedBy String?   @map("deleted_by")
  deletedAt DateTime? @map("deleted_at")

  @@map("users")
}

model Category {
  id             Int               @id @default(autoincrement())
  name           String            @default("anonymous")
  products       ProductCategory[]
  slugRegistryId Int               @map("slug_registry_id")
  slugRegistry   SlugRegistry      @relation(fields: [slugRegistryId], references: [id])
  thumbnail      Media?            @relation(fields: [thumbnailId], references: [id])
  thumbnailId    Int?              @map("thumbnail_id")

  @@map("categories")
}

model ProductCategory {
  productId  Int
  categoryId Int
  product    Product  @relation(fields: [productId], references: [id])
  category   Category @relation(fields: [categoryId], references: [id])
  createdAt  DateTime @default(now())

  @@id([productId, categoryId])
  @@map("product_categories")
}

model Product {
  id          Int    @id @default(autoincrement())
  name        String
  description String
  price       Float
  priceSale   Float  @map("price_sale")

  slugRegistryId Int          @map("slug_registry_id")
  slug           SlugRegistry @relation(fields: [slugRegistryId], references: [id])

  slugPlaceholder String            @unique @map("slug_placeholder") @db.VarChar(50)
  categories      ProductCategory[]

  /// [ProductMetadata]
  metadata Json?

  createdBy     String?        @map("created_by")
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedBy     String?        @map("updated_by")
  updatedAt     DateTime       @updatedAt @map("updated_at")
  isDeleted     Boolean        @default(false) @map("is_deleted")
  deletedBy     String?        @map("deleted_by")
  deletedAt     DateTime?      @map("deleted_at")
  productMedias ProductMedia[]

  @@map("products")
}

model ProductMedia {
  id          Int      @id @default(autoincrement())
  product     Product  @relation(fields: [productId], references: [id])
  productId   Int      @map("product_id")
  media       Media    @relation(fields: [mediaId], references: [id])
  mediaId     Int      @map("media_id")
  isThumbnail Boolean? @default(false)

  @@unique([productId, mediaId])
  @@map("product_medias")
}

enum PageType {
  HOME
  CATEGORY
  ABOUT
}

model Page {
  id             Int          @id @default(autoincrement())
  title          String
  type           PageType
  slugRegistryId Int          @map("slug_registry_id")
  slug           SlugRegistry @relation(fields: [slugRegistryId], references: [id])

  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime?     @updatedAt @map("updated_at")
  isDeleted    Boolean?      @default(false) @map("is_deleted")
  pageSections PageSection[]

  @@map("pages")
}

enum PageSectionType {
  banner
  category_slider
  category_product_section
}

model PageSection {
  id        Int             @id @default(autoincrement())
  type      PageSectionType
  position  Int
  config    Json
  is_active Boolean?        @default(false)
  pageId    Int             @map("page_id")
  page      Page            @relation(fields: [pageId], references: [id])

  @@unique([pageId, position])
  @@map("page_sections")
}

enum NavigatorTableRef {
  category
  page
}

model Navigator {
  id       Int               @id @default(autoincrement())
  parent   Int?
  label    String
  tableRef NavigatorTableRef @map("table_ref")
  ref      Int

  @@map("navigators")
}

model SlugRegistry {
  id         Int        @id @default(autoincrement())
  slug       String     @unique
  createdAt  DateTime   @default(now()) @map("created_at")
  updatedAt  DateTime?  @updatedAt @map("updated_at")
  products   Product[]
  categories Category[]
  pages      Page[]

  @@map("slug_registries")
}

model Media {
  id            Int            @id @default(autoincrement())
  key           String
  alt           String?
  /// [MediaMetadata]
  metadata      Json           @default("{}")
  provider      String?
  categories    Category[]
  productMedias ProductMedia[]

  @@map("medias")
}
