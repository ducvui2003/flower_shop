generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-arm64-openssl-3.0.x", "linux-musl-arm64-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator json {
  provider = "prisma-json-types-generator"
}

model User {
  id       Int    @id @default(autoincrement())
  name     String @default("anonymous")
  email    String @unique
  password String

  createdBy String?   @map("created_by")
  createdAt DateTime  @default(now()) @map("created_at")
  updatedBy String?   @map("updated_by")
  updatedAt DateTime  @updatedAt @map("updated_at")
  isDeleted Boolean   @default(false) @map("is_deleted")
  deletedBy String?   @map("deleted_by")
  deletedAt DateTime? @map("deleted_at")

  @@map("users")
}

model Category {
  id             Int               @id @default(autoincrement())
  name           String            @default("anonymous")
  parentId       Int?
  products       ProductCategory[]
  slugRegistryId Int               @map("slug_registry_id")
  slugRegistry   SlugRegistry      @relation(fields: [slugRegistryId], references: [id])
  thumbnail      Media?            @relation(fields: [thumbnailId], references: [id])
  thumbnailId    Int?              @map("thumbnail_id")

  @@map("categories")
}

model ProductCategory {
  productId  Int
  categoryId Int
  product    Product  @relation(fields: [productId], references: [id])
  category   Category @relation(fields: [categoryId], references: [id])
  createdAt  DateTime @default(now())

  @@id([productId, categoryId])
  @@map("product_categories")
}

model Product {
  id          Int    @id @default(autoincrement())
  name        String @default("anonymous")
  description String
  price       Float
  priceSale   Float? @map("price_sale")

  slugRegistryId Int               @map("slug_registry_id")
  slug           SlugRegistry      @relation(fields: [slugRegistryId], references: [id])
  categories     ProductCategory[]

  createdBy String?   @map("created_by")
  createdAt DateTime  @default(now()) @map("created_at")
  updatedBy String?   @map("updated_by")
  updatedAt DateTime  @updatedAt @map("updated_at")
  isDeleted Boolean   @default(false) @map("is_deleted")
  deletedBy String?   @map("deleted_by")
  deletedAt DateTime? @map("deleted_at")

  @@map("products")
}

enum PageType {
  HOME
  CATEGORY
  ABOUT
}

// Expect category and product page
model Page {
  id             Int          @id @default(autoincrement())
  title          String
  type           PageType
  /// [PageContent]
  content        Json
  slugRegistryId Int          @map("slug_registry_id")
  slug           SlugRegistry @relation(fields: [slugRegistryId], references: [id])

  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime? @updatedAt @map("updated_at")
  isDeleted Boolean?  @default(false) @map("is_deleted")

  @@map("pages")
}

model SlugRegistry {
  id         Int        @id @default(autoincrement())
  slug       String     @unique
  createdAt  DateTime   @default(now()) @map("created_at")
  updatedAt  DateTime?  @updatedAt @map("updated_at")
  products   Product[]
  categories Category[]
  pages      Page[]

  @@map("slug_registries")
}

model Media {
  id         Int        @id @default(autoincrement())
  url        String
  alt        String?
  metadata   Json?
  provider   String?
  categories Category[]

  @@map("medias")
}
